<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="web-boombox.js"></script>
    <link rel="stylesheet" href="custom-css-reset.css">
    <link rel="stylesheet" href="web-boombox.css">
    <style type="text/css">
html {
  background: hsl(0deg 0% 10%);
  
  font-family: Sans-Serif;
  color: hsl(188 100% 50%);
}

html * {
  border-radius: 0.5rem;
}

body {
  max-width: 50rem;
  margin: 1rem auto;
  padding: 0.2rem;
  
  background-image: linear-gradient(
    45deg,
    hsl(211deg 100% 46%) 0%,
    hsl(258deg 70% 65%) 21%,
    hsl(296deg 55% 60%) 30%,
    hsl(323deg 84% 65%) 39%,
    hsl(339deg 100% 69%) 46%,
    hsl(356deg 100% 72%) 54%,
    hsl(15deg 100% 70%) 61%,
    hsl(29deg 100% 66%) 69%,
    hsl(39deg 94% 64%) 79%,
    hsl(55deg 70% 62%) 100%
  );
}

body, audio, mp3-card {
  box-shadow:
    0 1px 1px hsl(0deg 0% 0% / 0.075),
    0 2px 2px hsl(0deg 0% 0% / 0.075),
    0 4px 4px hsl(0deg 0% 0% / 0.075),
    0 8px 8px hsl(0deg 0% 0% / 0.075),
    0 16px 16px hsl(0deg 0% 0% / 0.075);
}

audio {
  display: block;
  margin: auto;
  margin-bottom: 1rem;
  width: 100%;
  background: linear-gradient(to left, red, purple);
}

#drop_zone {
  min-height: 5rem;
  margin: auto;
  padding: 1rem;

  background-color: hsl(0deg 0% 20%);
  border-radius: 0.5rem;
  
  text-align: center;
  font-weight: bold;
}

.mp3-card {
  padding: 0.25rem;
  
  border-radius: 0.25rem;
  background-color: hsl(0deg 0% 25%);
}

#template { display: none; }

.pointer {
  cursor: pointer;
  font-weight: normal;
  display: inline-block;
}

.pointer:hover {
  animation-duration: 0.2s;
  animation-name: wiggle;
}

@keyframes wiggle {
  from { transform: rotate(0deg); }
  25% { transform: rotate(10deg); }
  75% { transform: rotate(-10deg); }
  to { transform: rotate(0deg); }
}
    </style>
    <script>

function dropHandler(ev){
  console.log('File(s) dropped');
  // Prevent default behavior (Prevent file from being opened)
  ev.preventDefault();
  
  name = '';
  document.querySelector('#drop_zone').classList.remove('drag');
  if (ev.dataTransfer.items) {
    // Use DataTransferItemList interface to access the file(s)
    for (var i = 0; i < ev.dataTransfer.items.length; i++) {
      // If dropped items aren't files, reject them
      if (ev.dataTransfer.items[i].kind === 'file') {
        var file = ev.dataTransfer.items[i].getAsFile();
        console.log('... file[' + i + '].name = ' + file.name);
        name = file.name;
        addCard(name);
        window.names.push (name);
        updateLocalStorage ();
      }
    }
  }
  
  load(name);
}

function addCard (name){
  new_card = document.querySelector('#template').cloneNode(true);
  new_card.removeAttribute('id');
  new_card.querySelector('.name').textContent = name;
  document.querySelector('#drop_zone').appendChild(new_card);
}

function load(name){
  document.querySelector('#title').textContent = name;
  document.querySelector('audio').src = name;
}

function dragOverHandler(ev) {
  console.log('File(s) in drop zone');
  // Prevent default behavior (Prevent file from being opened)
  ev.preventDefault();
}

function playHandler (ev) {
  load (ev.target.parentNode.querySelector('.name').textContent);
  document.title = ev.target.parentNode.querySelector('.name').textContent;
}

function removeHandler (ev) {
  document.querySelector ('#drop_zone').removeChild (ev.target.parentNode);
  i = window.names.indexOf (ev.target.parentNode.querySelector ('.name').textContent)
  window.names.splice (i, 1);
  updateLocalStorage ();
}

function updateLocalStorage(){
  window.localStorage.setItem ('names', JSON.stringify(window.names));
}

window.onload = function(){
  window.names = [];
  try { window.names = JSON.parse(window.localStorage.getItem('names')); }
  catch (e){ console.log(e); }
  
  if(window.names){
    for (var i = 0; i < window.names.length; ++i){
      addCard(window.names[i]);
    }
  }
}

    </script>
  </head>

  <body>
    <div id="drop_zone" ondrop="dropHandler(event);" ondragover="dragOverHandler(event);">
      <p id="title" class="mp3-card">proximity-2020.mp3</p>
      <audio src="proximity-2020.mp3" controls></audio>
      <p id="template" class="mp3-card" >
        <span class="pointer" onclick="playHandler(event);">&#127926;</span>
        <span class="pointer" onclick="removeHandler(event);">&#10060;</span>
        <span class="name">Template</span>
      </p>
    </div>
  </body>
</html>
